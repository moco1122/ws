filter(abs(x) > 0.0) %>%
filter(x > -1000)
fit_data
}
hdat <- hdat0 %>%
mutate(data = map(data, ~ select_fit_data(.x)))
#Regression and Prediction
#1. Tentative fitting for Gaussian noise.
mdat <- hdat %>%
mutate(lm_gauss0 =
map(data,
~ lm(log(count) ~ 1 + x + I(x^2),
data = filter(., count > max(count) * th_ncount_gauss0))))
mdat <- mdat %>%
mutate(data = map2(data, lm_gauss0,
~ .x %>%
mutate(pred_gauss0 = exp(predict(.y, .x)),
res1 = count - pred_gauss0,
Fit = ifelse(count > max(count) * th_ncount_gauss0,
"1_lm_gauss0", "0_notused"))))
coef_lm_gauss0 <- function(lm_gauss0) {
coef_gauss0 <- tidy_coef(lm_gauss0, c("a0", "a1", "a2"))
coef_gauss0 %>%
transmute(gauss0_A0 = exp(a0 - a1^2 / 4 / a2),
gauss0_mu = -(a1 / 2 / a2),
gauss0_sigma = sqrt(- 1 / 2 / a2),
gauss0_A = gauss0_A0 * sqrt(2 * pi) * gauss0_sigma)
}
mdat <- mdat %>% mutate(coef_gauss0 = map(lm_gauss0, coef_lm_gauss0))
saveRDS(mdat, gsub(".rds", "_model.rds", rds_file))
stop()
mdat
mdat %>% unnest(coef_gauss0)
hdat
rds_file <- glue("{dir}/hdat_RGrGbB.rds")
hdat <- readRDS(rds_file)
hdat <- hdat %>%
mutate(data = map2(data, ISO,
~ .x %>%
mutate(nx = x) %>%
filter(count >= 10) %>%
arrange(Pixel)))
hdat
rds_file <- glue("{dir}/hdat_RGrGbB.rds")
hdat <- readRDS(rds_file)
hdat <- hdat %>%
mutate(data = map(data,
~ .x %>%
mutate(nx = x) %>%
filter(count >= 10) %>%
arrange(Pixel)))
hdat
hdat[[1,6]]
hdat[[1,5]]
rds_file <- glue("{dir}/hdat_RGrGbB.rds")
hdat <- readRDS(rds_file)
hdat <- hdat %>%
mutate(data = map(data,
~ .x %>%
mutate(nx = x)))
#
# %>%
#                        filter(count > 0) %>%
#                        arrange(Pixel)))
hdat <- hdat %>% unnest(data)
#hdat <- filter(hdat, x > -1008)
# hdat <- mutate(hdat, nx = x / (ISO / 100))
# hdat <- mutate(hdat, nx = x)
# hdat <- filter(hdat, count >= 10)
# hdat <- arrange(hdat, Pixel)
g <- ggplot(hdat) + geom_point(aes(nx, y = count, color = Pixel))
g <- g + facet_wrap(~ ISO, scale = "free", nrow = 2)
#g <- g + coord_cartesian(xlim = c(-7.5, 7.5))
g <- g + scale_y_log10()
plot(g)
hdat
rds_file <- glue("{dir}/hdat_RGrGbB.rds")
hdat <- readRDS(rds_file)
hdat <- hdat %>%
mutate(data = map(data,
~ .x %>%
mutate(nx = x) %>%
filter(count > 0)))
#
#
#                         %>%
#                        arrange(Pixel)))
hdat <- hdat %>% unnest(data)
#hdat <- filter(hdat, x > -1008)
# hdat <- mutate(hdat, nx = x / (ISO / 100))
# hdat <- mutate(hdat, nx = x)
# hdat <- filter(hdat, count >= 10)
# hdat <- arrange(hdat, Pixel)
g <- ggplot(hdat) + geom_point(aes(nx, y = count, color = Pixel))
g <- g + facet_wrap(~ ISO, scale = "free", nrow = 2)
#g <- g + coord_cartesian(xlim = c(-7.5, 7.5))
g <- g + scale_y_log10()
plot(g)
rds_file <- glue("{dir}/hdat_RGrGbB.rds")
hdat <- readRDS(rds_file)
hdat <- hdat %>%
mutate(data = map(data,
~ .x %>%
mutate(nx = x) %>%
filter(count > 0) %>%
filter(x > min(x))))
#
#
#                         %>%
#                        arrange(Pixel)))
hdat <- hdat %>% unnest(data)
#hdat <- filter(hdat, x > -1008)
# hdat <- mutate(hdat, nx = x / (ISO / 100))
# hdat <- mutate(hdat, nx = x)
# hdat <- filter(hdat, count >= 10)
# hdat <- arrange(hdat, Pixel)
g <- ggplot(hdat) + geom_point(aes(nx, y = count, color = Pixel))
g <- g + facet_wrap(~ ISO, scale = "free", nrow = 2)
#g <- g + coord_cartesian(xlim = c(-7.5, 7.5))
g <- g + scale_y_log10()
plot(g)
source("tidyverse.R", encoding = "UTF8")
library(modelr)
dir <- "/Volumes/data/Photo/astrophoto/2019/20190622bias_D810A/dat"
basename <- "dump_RGrGbB_offset0"
source("tidyverse.R", encoding = "UTF8")
library(modelr)
dir0 <- "/Volumes/data/Photo/astrophoto/2019/20190622bias_D810A/dat"
dir <- "/ws/notebook/dat/"
basename <- "dump_RGrGbB_offset0"
csv_file <- glue("{dir0}/{basename}.csv")
dat <- read_csv0(csv_file)
dat <- nest(dat, -File, -ISO, -Exposure) %>%
mutate(ISO = case_when(
File == "./DSC_1396.NEF" ~ 100,
File == "./DSC_1404.NEF" ~ 25600,
File == "./DSC_1405.NEF" ~ 51200,
TRUE ~ ISO))
saveRDS(dat, gsub(".csv", ".rds", csv_file))
csv_file <- glue("{dir0}/{basename}.csv")
dat <- read_csv0(csv_file)
dat <- nest(dat, -File, -ISO, -Exposure) %>%
mutate(ISO = case_when(
File == "./DSC_1396.NEF" ~ 100,
File == "./DSC_1404.NEF" ~ 25600,
File == "./DSC_1405.NEF" ~ 51200,
TRUE ~ ISO))
saveRDS(dat, glue("{dir}/{basename}.csv"))
source("tidyverse.R", encoding = "UTF8")
library(modelr)
dir0 <- "/Volumes/data/Photo/astrophoto/2019/20190622bias_D810A/dat"
dir <- "/ws/notebook/dat"
basename <- "dump_RGrGbB_offset0"
csv_file <- glue("{dir0}/{basename}.csv")
dat <- read_csv0(csv_file)
dat <- nest(dat, -File, -ISO, -Exposure) %>%
mutate(ISO = case_when(
File == "./DSC_1396.NEF" ~ 100,
File == "./DSC_1404.NEF" ~ 25600,
File == "./DSC_1405.NEF" ~ 51200,
TRUE ~ ISO))
saveRDS(dat, glue("{dir}/{basename}.csv"))
rds_file <- glue("{dir}/{basename}.rds")
dat <- readRDS(rds_file)
csv_file <- glue("{dir0}/{basename}.csv")
dat <- read_csv0(csv_file)
dat <- nest(dat, -File, -ISO, -Exposure) %>%
mutate(ISO = case_when(
File == "./DSC_1396.NEF" ~ 100,
File == "./DSC_1404.NEF" ~ 25600,
File == "./DSC_1405.NEF" ~ 51200,
TRUE ~ ISO))
saveRDS(dat, glue("{dir}/{basename}.rds"))
rds_file <- glue("{dir}/{basename}.rds")
dat <- readRDS(rds_file)
head(dat)
dat[[1,4]]
rds_file <- glue("{dir}/{basename}.rds")
dat <- readRDS(rds_file)
gdat <- dat %>% unnest(data) %>%
gather(Pixel, Value, -File, -ISO, -Exposure, -X, -Y)
gdat <- gdat %>%
group_by(File, ISO, Exposure, Pixel) %>%
nest()
#gdat <- gdat %>% filter(ISO == 400)
to_histogram_data <- function(Value) {
pb$tick()$print()
g <- ggplot() + geom_histogram(aes(Value), binwidth = 1)
hist_data <- layer_data(g) %>% as_tibble()
hist_data <- hist_data %>% transmute(x, count, ncount)
hist_data
}
pb <- progress_estimated(nrow(gdat))
hdat <- gdat %>%
mutate(data = map(data, ~ to_histogram_data(.x$Value)))
saveRDS(hdat, glue("{dir}/{basename}_hdat.rds"))
rds_file <- glue("{dir}/{basename}_hdat.rds")
hdat <- readRDS(rds_file)
hdat <- hdat %>%
mutate(data = map(data,
~ .x %>%
mutate(nx = x) %>%
filter(count > 0) %>%
filter(x > min(x))))
#
#
#                         %>%
#                        arrange(Pixel)))
hdat <- hdat %>% unnest(data)
#hdat <- filter(hdat, x > -1008)
# hdat <- mutate(hdat, nx = x / (ISO / 100))
# hdat <- mutate(hdat, nx = x)
# hdat <- filter(hdat, count >= 10)
# hdat <- arrange(hdat, Pixel)
g <- ggplot(hdat) + geom_point(aes(nx, y = count, color = Pixel))
g <- g + facet_wrap(~ ISO, scale = "free", nrow = 2)
#g <- g + coord_cartesian(xlim = c(-7.5, 7.5))
g <- g + scale_y_log10()
plot(g)
rds_file <- glue("{dir}/{basename}_hdat.rds")
hdat <- readRDS(rds_file)
hdat <- hdat %>%
mutate(data = map2(data, ISO,
~ .x %>%
mutate(nx = x / (ISO / 100)) %>%
filter(count > 0) %>%
filter(x > min(x))))
rds_file <- glue("{dir}/{basename}_hdat.rds")
hdat <- readRDS(rds_file)
hdat <- hdat %>%
mutate(data = map2(data, ISO,
~ .x %>%
mutate(nx = x / (.y / 100)) %>%
filter(count > 0) %>%
filter(x > min(x))))
#
#
#                         %>%
#                        arrange(Pixel)))
hdat <- hdat %>% unnest(data)
#hdat <- filter(hdat, x > -1008)
# hdat <- mutate(hdat, nx = x / (ISO / 100))
# hdat <- mutate(hdat, nx = x)
# hdat <- filter(hdat, count >= 10)
# hdat <- arrange(hdat, Pixel)
g <- ggplot(hdat) + geom_point(aes(nx, y = count, color = Pixel))
g <- g + facet_wrap(~ ISO, scale = "free", nrow = 2)
#g <- g + coord_cartesian(xlim = c(-7.5, 7.5))
g <- g + scale_y_log10()
plot(g)
source("tidyverse.R", encoding = "UTF8")
library(modelr)
dir0 <- "/Volumes/data/Photo/astrophoto/2019/20190622bias_D810A/dat"
dir <- "/ws/notebook/dat"
basename <- "dump_RGrGbB_offset0"
basename <- "dump_RGrGbB"
csv_file <- glue("{dir0}/{basename}.csv")
dat <- read_csv0(csv_file)
dat <- nest(dat, -File, -ISO, -Exposure) %>%
mutate(ISO = case_when(
File == "./DSC_1396.NEF" ~ 100,
File == "./DSC_1404.NEF" ~ 25600,
File == "./DSC_1405.NEF" ~ 51200,
TRUE ~ ISO))
saveRDS(dat, glue("{dir}/{basename}.rds"))
rds_file <- glue("{dir}/{basename}.rds")
dat <- readRDS(rds_file)
gdat <- dat %>% unnest(data) %>%
gather(Pixel, Value, -File, -ISO, -Exposure, -X, -Y)
gdat <- gdat %>%
group_by(File, ISO, Exposure, Pixel) %>%
nest()
#gdat <- gdat %>% filter(ISO == 400)
to_histogram_data <- function(Value) {
pb$tick()$print()
g <- ggplot() + geom_histogram(aes(Value), binwidth = 1)
hist_data <- layer_data(g) %>% as_tibble()
hist_data <- hist_data %>% transmute(x, count, ncount)
hist_data
}
pb <- progress_estimated(nrow(gdat))
hdat <- gdat %>%
mutate(data = map(data, ~ to_histogram_data(.x$Value)))
saveRDS(hdat, glue("{dir}/{basename}_hdat.rds"))
rds_file <- glue("{dir}/{basename}_hdat.rds")
hdat <- readRDS(rds_file)
hdat <- hdat %>%
mutate(data = map2(data, ISO,
~ .x %>%
mutate(nx = x / (.y / 100)) %>%
filter(count > 0) %>%
filter(x > min(x))))
#
#
#                         %>%
#                        arrange(Pixel)))
hdat <- hdat %>% unnest(data)
#hdat <- filter(hdat, x > -1008)
# hdat <- mutate(hdat, nx = x / (ISO / 100))
# hdat <- mutate(hdat, nx = x)
# hdat <- filter(hdat, count >= 10)
# hdat <- arrange(hdat, Pixel)
g <- ggplot(hdat) + geom_point(aes(nx, y = count, color = Pixel))
g <- g + facet_wrap(~ ISO, scale = "free", nrow = 2)
#g <- g + coord_cartesian(xlim = c(-7.5, 7.5))
g <- g + scale_y_log10()
plot(g)
rds_file <- glue("{dir}/{basename}_hdat.rds")
hdat <- readRDS(rds_file)
hdat <- hdat %>%
mutate(data = map2(data, ISO,
~ .x %>%
mutate(nx = x / (.y / 100)) %>%
filter(count > 1) %>%
filter(x > min(x))))
#
#
#                         %>%
#                        arrange(Pixel)))
hdat <- hdat %>% unnest(data)
#hdat <- filter(hdat, x > -1008)
# hdat <- mutate(hdat, nx = x / (ISO / 100))
# hdat <- mutate(hdat, nx = x)
# hdat <- filter(hdat, count >= 10)
# hdat <- arrange(hdat, Pixel)
g <- ggplot(hdat) + geom_point(aes(nx, y = count, color = Pixel))
g <- g + facet_wrap(~ ISO, scale = "free", nrow = 2)
#g <- g + coord_cartesian(xlim = c(-7.5, 7.5))
g <- g + scale_y_log10()
plot(g)
rds_file <- glue("{dir}/{basename}_hdat.rds")
hdat <- readRDS(rds_file)
hdat <- hdat %>%
mutate(data = map2(data, ISO,
~ .x %>%
mutate(nx = x / (.y / 100)) %>%
filter(count > 1) %>%
filter(x > min(x))))
#
#
#                         %>%
#                        arrange(Pixel)))
hdat <- hdat %>% unnest(data)
#hdat <- filter(hdat, x > -1008)
# hdat <- mutate(hdat, nx = x / (ISO / 100))
# hdat <- mutate(hdat, nx = x)
# hdat <- filter(hdat, count >= 10)
# hdat <- arrange(hdat, Pixel)
g <- ggplot(hdat) + geom_point(aes(x, y = count, color = Pixel))
g <- g + facet_wrap(~ ISO, scale = "free", nrow = 2)
#g <- g + coord_cartesian(xlim = c(-7.5, 7.5))
g <- g + scale_y_log10()
plot(g)
dat
mutate(dat, min = map_int(data, ~ min(.x$x)))
mutate(dat, min = map_int(data, ~ min(.x$x)))
mutate(dat, min = map_dbl(data, ~ min(.x$x)))
dat[[1,5]]
dat[[1,4]]
min(dat[[1,4]]$Gr)
mutate(dat, min = map_dbl(data, ~ min(.x$X)))
mutate(dat, min = map_dbl(data, ~ min(.x$R)))
mutate(dat, min = map(data, ~ .x %>% summarise_all(min))
)
mutate(dat, min = map(data, ~ .x %>% summarise_all(min))) %>% unnest(min)
rds_file <- glue("{dir}/{basename}.rds")
dat <- readRDS(rds_file)
head(dat)
mutate(dat, min = map(data, ~ .x %>% summarise_all(min))) %>% unnest(min)
ls
source("tidyverse.R", encoding = "UTF8")
library(modelr)
dir0 <- "/Volumes/data/Photo/astrophoto/2019/20190622bias_D810/dat"
dir <- "/ws/notebook/dat"
basename <- "dump_D810"
csv_file <- glue("{dir0}/{basename}.csv")
dat <- read_csv0(csv_file)
dat <- nest(dat, -File, -ISO, -Exposure) %>%
mutate(ISO = case_when(
File == "./DSC_1386.NEF" ~ 32,
File == "./DSC_1396.NEF" ~ 25600,
File == "./DSC_1397.NEF" ~ 51200,
TRUE ~ ISO))
saveRDS(dat, glue("{dir}/{basename}.rds"))
rds_file <- glue("{dir}/{basename}.rds")
dat <- readRDS(rds_file)
head(dat)
mutate(dat, min = map(data, ~ .x %>% summarise_all(min))) %>% unnest(min)
rds_file <- glue("{dir}/{basename}.rds")
dat <- readRDS(rds_file)
head(dat)
mutate(dat, min = map(data, ~ .x %>% summarise_all(min))) %>% unnest(min)
rds_file <- glue("{dir}/{basename}.rds")
dat <- readRDS(rds_file)
gdat <- dat %>% unnest(data) %>%
gather(Pixel, Value, -File, -ISO, -Exposure, -X, -Y)
gdat <- gdat %>%
group_by(File, ISO, Exposure, Pixel) %>%
nest()
#gdat <- gdat %>% filter(ISO == 400)
to_histogram_data <- function(Value) {
pb$tick()$print()
g <- ggplot() + geom_histogram(aes(Value), binwidth = 1)
hist_data <- layer_data(g) %>% as_tibble()
hist_data <- hist_data %>% transmute(x, count, ncount)
hist_data
}
pb <- progress_estimated(nrow(gdat))
hdat <- gdat %>%
mutate(data = map(data, ~ to_histogram_data(.x$Value)))
saveRDS(hdat, glue("{dir}/{basename}_hdat.rds"))
rds_file <- glue("{dir}/{basename}_hdat.rds")
hdat <- readRDS(rds_file)
hdat <- hdat %>%
mutate(data = map2(data, ISO,
~ .x %>%
mutate(nx = x / (.y / 100)) %>%
filter(count > 1) %>%
filter(x > min(x))))
#
#
#                         %>%
#                        arrange(Pixel)))
hdat <- hdat %>% unnest(data)
#hdat <- filter(hdat, x > -1008)
# hdat <- mutate(hdat, nx = x / (ISO / 100))
# hdat <- mutate(hdat, nx = x)
# hdat <- filter(hdat, count >= 10)
# hdat <- arrange(hdat, Pixel)
g <- ggplot(hdat) + geom_point(aes(x, y = count, color = Pixel))
g <- g + facet_wrap(~ ISO, scale = "free", nrow = 2)
#g <- g + coord_cartesian(xlim = c(-7.5, 7.5))
g <- g + scale_y_log10()
plot(g)
2^-0.2
library(tidyverse)
seeings <- seq(0.5, 2.0, 0.2)
guid_rms <- seq(0.5, 2.0, 0.2)
sigma <- sqrt(seeings^2 + guid_rms^2)
ggplot() + geom_line(aes(seeings, sigma, color = factor(guid_rms)))
seeing <- seq(0.5, 2.0, 0.2)
guid_rms <- seq(0.5, 2.0, 0.2)
sigma <- sqrt(seeings^2 + guid_rms^2)
dat <- tibble(seeing, guid_rms, sigma)
ggplot(dat) + geom_line(aes(seeing, sigma, color = factor(guid_rms)))
dat
dat <- tibble(guid_rms) %>% nest()
dat <- tibble(guid_rms) %>% nest() %>%
mutate(dat = map(guid_rms, ~ tibble(seeing, sigma = sqrt(.x^2 + seeing^2))))
dat <- tibble(guid_rms) %>% nest() %>%
mutate(data = map(guid_rms, ~ tibble(seeing, sigma = sqrt(.x^2 + seeing^2))))
mutate(data = map(guid_rms, ~ tibble(seeing,)) # sigma = sqrt(.x^2 + seeing^2))))
dat <- tibble(guid_rms) %>% nest() %>%
dat <- tibble(guid_rms) %>% nest() %>%
mutate(data = map(guid_rms, ~ tibble(seeing))) # sigma = sqrt(.x^2 + seeing^2))))
dat <- tibble(guid_rms) %>%
mutate(data = map(guide_rms, ~ tibble(seeing))) # sigma = sqrt(.x^2 + seeing^2))))
guide_rms <- seq(0.5, 2.0, 0.2)
dat <- tibble(guid_rms) %>%
mutate(data = map(guide_rms, ~ tibble(seeing))) # sigma = sqrt(.x^2 + seeing^2))))
dat
dat <- tibble(guid_rms) %>%
mutate(data = map(guide_rms, ~ tibble(seeing, sigma = sqrt(seeing ^ 2 + .x ^ 2)))) # sigma = sqrt(.x^2 + seeing^2))))
dat
unnest(dat)
seeing <- seq(0.5, 2.0, 0.2)
guide_rms <- seq(0.5, 2.0, 0.2)
sigma <- sqrt(seeings^2 + guide_rms^2)
dat <- tibble(guid_rms) %>%
mutate(data = map(guide_rms,
~ tibble(seeing, sigma = sqrt(seeing ^ 2 + .x ^ 2)))) %>%
unnest()
ggplot(dat) + geom_line(aes(seeing, sigma, color = factor(guid_rms)))
seeing <- seq(0.5, 2.0, 0.2)
guide_rms <- seq(0.5, 2.0, 0.2)
sigma <- sqrt(seeings^2 + guide_rms^2)
dat <- tibble(guide_rms) %>%
mutate(data = map(guide_rms,
~ tibble(seeing, sigma = sqrt(seeing ^ 2 + .x ^ 2)))) %>%
unnest()
ggplot(dat) + geom_line(aes(seeing, sigma, color = factor(guide_rms)))
install.packages(c("imager", "shiny", "shinythemes"))
shiny::runApp('/ws/Astro/ASApp')
runApp('/ws/Astro/ASApp')
runApp('/ws/Astro/ASApp')
runApp('/ws/Astro/ASApp')
runApp('/ws/Astro/ASApp')
?checkboxGroupInput
?radioButtons
runApp('/ws/Astro/ASApp')
runApp('/ws/Astro/ASApp')
runApp('/ws/Astro/ASApp')
array(1:24, c(4,6))
array(1:24, c(4,6)) -> aaa
aaa[1,1]
aaa[seq(1, 4, 2), ] <- 0
aaa
array(1:24, c(4,6)) -> aaa
aaa[seq(1, 4, 2), seq(1, 4, 2)]
aaa[seq(1, 4, 2), seq(1, 6, 2)]
aaa
aaa[seq(1, 4, 2), seq(1 + 1, 6, 2)]
runApp('/ws/Astro/ASApp')
image[index_om, index_om, 3] <- (
bayer[index_om - 1, index_om - 1] +
bayer[index_om - 1, index_om + 1] +
bayer[index_om + 1, index_om - 1] +
bayer[index_om + 1, index_om + 1]) / 4
runApp('/ws/Astro/ASApp')
runApp('/ws/Astro/ASApp')
runApp('/ws/Astro/ASApp')
runApp('/ws/Astro/ASApp')
